@page "/subscribers"
@using MailingListManager.Services
@using MailingListManager.Models
@inject SubscriberService SubscriberService

<AuthorizeView>
    <Authorized>
        <div class="container mt-5">
            <div class="row">
                <div class="col-md-10">
                    <h1>?? Prenumeranter</h1>
                    
                    @if (subscribers == null)
                    {
                        <p>Laddar...</p>
                    }
                    else if (subscribers.Count == 0)
                    {
                        <div class="alert alert-info" role="alert">
                            <h4 class="alert-heading">Inga prenumeranter ännu</h4>
                            <p>Listan är tom. Lägg till din första prenumerant för att komma igång!</p>
                        </div>
                    }
                    else
                    {
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Email</th>
                                        <th>Tillagd</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var subscriber in subscribers)
                                    {
                                        <tr>
                                            <td>@subscriber.Email</td>
                                            <td>@subscriber.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
            </div>
        </div>
    </Authorized>
    <NotAuthorized>
        <div class="alert alert-warning" role="alert">
            Du måste logga in för att se prenumeranter. <a href="/login" class="alert-link">Gå till inloggning</a>
        </div>
    </NotAuthorized>
</AuthorizeView>

@code {
    private List<Subscriber>? subscribers;

    protected override async Task OnInitializedAsync()
    {
        subscribers = await SubscriberService.GetAllAsync();
    }
}
